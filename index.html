<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>GeoPin - Location Encoder</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: #0a0a0a;
			color: #e4e4e7;
			line-height: 1.5;
		}

		.container {
			max-width: 480px;
			margin: 0 auto;
			padding: 1rem;
		}

		.header {
			text-align: center;
			padding: 2rem 0 1rem;
		}

		.logo {
			font-size: 2rem;
			font-weight: 700;
			color: #60a5fa;
			margin-bottom: 0.5rem;
		}

		.tagline {
			color: #9ca3af;
			font-size: 0.9rem;
		}

		.card {
			background: #1a1a1a;
			border: 1px solid #2a2a2a;
			border-radius: 12px;
			padding: 1.5rem;
			margin-bottom: 1rem;
		}

		.tabs {
			display: flex;
			gap: 0.5rem;
			margin-bottom: 1.5rem;
		}

		.tab {
			flex: 1;
			padding: 0.75rem;
			background: #2a2a2a;
			border: none;
			border-radius: 8px;
			color: #9ca3af;
			cursor: pointer;
			transition: all 0.2s;
			font-size: 0.875rem;
		}

		.tab.active {
			background: #60a5fa;
			color: #0a0a0a;
		}

		.tab-content {
			display: none;
		}

		.tab-content.active {
			display: block;
		}

		.input-group {
			margin-bottom: 1rem;
		}

		.input-row {
			display: flex;
			gap: 0.5rem;
		}

		.input-row input {
			flex: 1;
		}

		input,
		select {
			width: 100%;
			padding: 0.75rem;
			background: #2a2a2a;
			border: 1px solid #3a3a3a;
			border-radius: 8px;
			color: #e4e4e7;
			font-size: 0.875rem;
		}

		input:focus,
		select:focus {
			outline: none;
			border-color: #60a5fa;
		}

		input::placeholder {
			color: #6b7280;
		}

		.btn {
			width: 100%;
			padding: 0.875rem;
			background: linear-gradient(135deg, #3b82f6, #1d4ed8);
			border: none;
			border-radius: 8px;
			color: white;
			font-weight: 600;
			cursor: pointer;
			transition: transform 0.2s;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0.5rem;
			font-size: 0.875rem;
		}

		.btn:hover {
			transform: translateY(-1px);
		}

		.btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
			transform: none;
		}

		.btn-secondary {
			background: #374151;
			margin-top: 0.5rem;
		}

		.btn-secondary:hover {
			background: #4b5563;
		}

		#map {
			height: 250px;
			border-radius: 8px;
			margin-bottom: 1rem;
		}

		.result {
			background: #0f172a;
			border: 1px solid #1e293b;
			border-radius: 8px;
			padding: 1rem;
			margin-top: 1rem;
			display: none;
		}

		.result.show {
			display: block;
			animation: slideUp 0.3s ease;
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.geopin-code {
			font-family: 'Monaco', monospace;
			font-size: 1.25rem;
			font-weight: bold;
			color: #60a5fa;
			text-align: center;
			padding: 1rem;
			background: #1a1a1a;
			border-radius: 8px;
			margin: 1rem 0;
			letter-spacing: 1px;
		}

		.coords-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 0.75rem;
			margin: 1rem 0;
		}

		.coord-box {
			background: #1a1a1a;
			padding: 0.75rem;
			border-radius: 6px;
			text-align: center;
		}

		.coord-label {
			font-size: 0.75rem;
			color: #9ca3af;
			margin-bottom: 0.25rem;
		}

		.coord-value {
			font-weight: 600;
			color: #e4e4e7;
		}

		.error {
			background: #7f1d1d;
			color: #fecaca;
			padding: 0.75rem;
			border-radius: 8px;
			margin-top: 1rem;
			font-size: 0.875rem;
		}

		.loading {
			display: inline-block;
			width: 16px;
			height: 16px;
			border: 2px solid #3a3a3a;
			border-top: 2px solid #60a5fa;
			border-radius: 50%;
			animation: spin 1s linear infinite;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		.precision-info {
			background: #1e293b;
			padding: 0.75rem;
			border-radius: 6px;
			margin-top: 1rem;
			font-size: 0.8rem;
			color: #94a3b8;
		}

		.status {
			position: fixed;
			top: 1rem;
			right: 1rem;
			padding: 0.5rem 0.75rem;
			border-radius: 20px;
			font-size: 0.75rem;
			font-weight: 500;
			z-index: 1000;
		}

		.status.online {
			background: #065f46;
			color: #86efac;
		}

		.status.offline {
			background: #7f1d1d;
			color: #fecaca;
		}

		.footer {
			text-align: center;
			padding: 2rem 0;
			color: #6b7280;
			font-size: 0.8rem;
		}

		/* Responsive */
		@media (max-width: 480px) {
			.container {
				padding: 0.75rem;
			}

			.header {
				padding: 1.5rem 0 1rem;
			}

			.logo {
				font-size: 1.75rem;
			}

			.card {
				padding: 1rem;
			}

			.coords-grid {
				grid-template-columns: 1fr;
			}
		}

		/* Dark scrollbar */
		::-webkit-scrollbar {
			width: 8px;
		}

		::-webkit-scrollbar-track {
			background: #1a1a1a;
		}

		::-webkit-scrollbar-thumb {
			background: #3a3a3a;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #4a4a4a;
		}
	</style>
</head>

<body>
	<div class="status" id="status">
		<span class="loading"></span> Checking...
	</div>

	<div class="container">
		<div class="header">
			<div class="logo">GeoPin üåç</div>
			<div class="tagline">Military-Grade Coordinate Encoding</div>
		</div>

		<div class="card">
			<div class="tabs">
				<button class="tab active" onclick="switchTab('encode')">Encode</button>
				<button class="tab" onclick="switchTab('decode')">Decode</button>
				<button class="tab" onclick="switchTab('map')">Map</button>
			</div>

			<!-- Encode Tab -->
			<div class="tab-content active" id="encode-tab">
				<div class="input-group">
					<div class="input-row">
						<input type="number" id="lat" placeholder="Latitude" step="any" min="-90" max="90">
						<input type="number" id="lng" placeholder="Longitude" step="any" min="-180" max="180">
					</div>
				</div>
				<button class="btn" onclick="encode()">
					<span id="encode-loading" class="loading" style="display: none;"></span>
					Generate GeoPin
				</button>
				<button class="btn btn-secondary" onclick="getLocation()">
					üìç Use My Location
				</button>
			</div>

			<!-- Decode Tab -->
			<div class="tab-content" id="decode-tab">
				<div class="input-group">
					<input type="text" id="geopin" placeholder="Enter GeoPin (e.g., 2A5G-H3K7-M9P4)"
						style="text-transform: uppercase;">
				</div>
				<button class="btn" onclick="decode()">
					<span id="decode-loading" class="loading" style="display: none;"></span>
					Decode Location
				</button>
			</div>

			<!-- Map Tab -->
			<div class="tab-content" id="map-tab">
				<div style="text-align: center; margin-bottom: 1rem; color: #9ca3af; font-size: 0.875rem;">
					Click anywhere to generate GeoPin
				</div>
				<div id="map"></div>
			</div>

			<!-- Results -->
			<div class="result" id="result">
				<div id="result-content"></div>
			</div>

			<div class="precision-info">
				<strong>Military-Grade Precision:</strong> WGS84 Datum ‚Ä¢ Sub-meter accuracy ‚Ä¢ Global coverage
			</div>
		</div>
	</div>

	<div class="footer">
		Made with ‚ù§Ô∏è by Ritu Raj Pratap Singh
	</div>

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script>
		const API_BASE = 'https://geopin.koyeb.app/api';
		let map, marker;

		// Check API status
		async function checkStatus() {
			try {
				const response = await fetch(`${API_BASE}/health`);
				const statusEl = document.getElementById('status');

				if (response.ok) {
					const data = await response.json();
					statusEl.textContent = 'üü¢ Online';
					statusEl.className = 'status online';
				} else {
					throw new Error('API Error');
				}
			} catch (error) {
				const statusEl = document.getElementById('status');
				statusEl.textContent = 'üî¥ Offline';
				statusEl.className = 'status offline';
			}
		}

		// Initialize map
		function initMap() {
			if (map) return;

			map = L.map('map').setView([20.5937, 78.9629], 6);
			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '¬© OpenStreetMap'
			}).addTo(map);

			map.on('click', function (e) {
				const lat = e.latlng.lat.toFixed(6);
				const lng = e.latlng.lng.toFixed(6);

				document.getElementById('lat').value = lat;
				document.getElementById('lng').value = lng;

				if (marker) map.removeLayer(marker);
				marker = L.marker([lat, lng]).addTo(map);

				encode();
			});
		}

		// Switch tabs
		function switchTab(tab) {
			document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
			document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

			event.target.classList.add('active');
			document.getElementById(`${tab}-tab`).classList.add('active');

			if (tab === 'map') {
				setTimeout(initMap, 100);
			}
		}

		// Get user location
		function getLocation() {
			if (!navigator.geolocation) {
				showError('Geolocation not supported');
				return;
			}

			navigator.geolocation.getCurrentPosition(
				pos => {
					document.getElementById('lat').value = pos.coords.latitude.toFixed(6);
					document.getElementById('lng').value = pos.coords.longitude.toFixed(6);

					if (map) {
						map.setView([pos.coords.latitude, pos.coords.longitude], 15);
						if (marker) map.removeLayer(marker);
						marker = L.marker([pos.coords.latitude, pos.coords.longitude]).addTo(map);
					}
				},
				error => showError('Location access denied'),
				{ enableHighAccuracy: true }
			);
		}

		// Encode coordinates
		async function encode() {
			const lat = parseFloat(document.getElementById('lat').value);
			const lng = parseFloat(document.getElementById('lng').value);

			if (isNaN(lat) || isNaN(lng)) {
				showError('Enter valid coordinates');
				return;
			}

			if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
				showError('Coordinates out of range');
				return;
			}

			const loading = document.getElementById('encode-loading');
			loading.style.display = 'inline-block';

			try {
				const response = await fetch(`${API_BASE}/encode`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ latitude: lat, longitude: lng })
				});

				const data = await response.json();

				if (response.ok && data.geopin) {
					showEncodeResult(data);

					if (map) {
						map.setView([lat, lng], 15);
						if (marker) map.removeLayer(marker);
						marker = L.marker([lat, lng])
							.addTo(map)
							.bindPopup(`GeoPin: ${data.geopin}`)
							.openPopup();
					}
				} else {
					showError(data.error || 'Encoding failed');
				}
			} catch (error) {
				showError('Network error');
			} finally {
				loading.style.display = 'none';
			}
		}

		// Decode GeoPin
		async function decode() {
			const geopin = document.getElementById('geopin').value.trim().toUpperCase();

			if (!geopin) {
				showError('Enter GeoPin code');
				return;
			}

			const loading = document.getElementById('decode-loading');
			loading.style.display = 'inline-block';

			try {
				const response = await fetch(`${API_BASE}/decode`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ geopin: geopin })
				});

				const data = await response.json();

				if (response.ok && data.latitude !== undefined && data.longitude !== undefined) {
					showDecodeResult(data);

					if (map) {
						map.setView([data.latitude, data.longitude], 15);
						if (marker) map.removeLayer(marker);
						marker = L.marker([data.latitude, data.longitude])
							.addTo(map)
							.bindPopup(`Decoded: ${geopin}`)
							.openPopup();
					}
				} else {
					showError(data.error || 'Invalid GeoPin');
				}
			} catch (error) {
				showError('Network error');
			} finally {
				loading.style.display = 'none';
			}
		}

		// Show encode result
		function showEncodeResult(data) {
			const accuracy = data.precision?.latitude || data.approximateAccuracy?.latitude || 'Sub-meter';
			const content = `
                <div class="geopin-code">${data.geopin}</div>
                <div class="coords-grid">
                    <div class="coord-box">
                        <div class="coord-label">Latitude</div>
                        <div class="coord-value">${data.input.latitude}¬∞</div>
                    </div>
                    <div class="coord-box">
                        <div class="coord-label">Longitude</div>
                        <div class="coord-value">${data.input.longitude}¬∞</div>
                    </div>
                </div>
                <div style="text-align: center; margin: 0.5rem 0; font-size: 0.8rem; color: #9ca3af;">
                    Precision: ${accuracy} ‚Ä¢ WGS84 Datum
                </div>
                <button class="btn" onclick="copy('${data.geopin}')">üìã Copy GeoPin</button>
            `;
			showResult(content);
		}

		// Show decode result
		function showDecodeResult(data) {
			const accuracy = data.approximateAccuracy?.latitude || 'Sub-meter';
			const content = `
                <div style="text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 1rem; color: #60a5fa; font-weight: 600;">${data.geopin}</div>
                </div>
                <div class="coords-grid">
                    <div class="coord-box">
                        <div class="coord-label">Latitude</div>
                        <div class="coord-value">${data.latitude}¬∞</div>
                    </div>
                    <div class="coord-box">
                        <div class="coord-label">Longitude</div>
                        <div class="coord-value">${data.longitude}¬∞</div>
                    </div>
                </div>
                <div style="text-align: center; margin: 0.5rem 0; font-size: 0.8rem; color: #9ca3af;">
                    Precision: ${accuracy} ‚Ä¢ WGS84 Datum
                </div>
                <button class="btn" onclick="copy('${data.latitude}, ${data.longitude}')">üìã Copy Coordinates</button>
            `;
			showResult(content);
		}

		// Show result
		function showResult(content) {
			const resultEl = document.getElementById('result');
			document.getElementById('result-content').innerHTML = content;
			resultEl.classList.add('show');
		}

		// Show error
		function showError(message) {
			const content = `<div class="error">‚ùå ${message}</div>`;
			showResult(content);
		}

		// Copy to clipboard
		function copy(text) {
			navigator.clipboard.writeText(text).then(() => {
				const btn = event.target;
				const original = btn.textContent;
				btn.textContent = '‚úÖ Copied!';
				setTimeout(() => btn.textContent = original, 2000);
			}).catch(() => {
				const textarea = document.createElement('textarea');
				textarea.value = text;
				document.body.appendChild(textarea);
				textarea.select();
				document.execCommand('copy');
				document.body.removeChild(textarea);

				const btn = event.target;
				const original = btn.textContent;
				btn.textContent = '‚úÖ Copied!';
				setTimeout(() => btn.textContent = original, 2000);
			});
		}

		// Initialize
		document.addEventListener('DOMContentLoaded', function () {
			checkStatus();

			// Auto-encode on input change
			let timeout;
			const latInput = document.getElementById('lat');
			const lngInput = document.getElementById('lng');

			function autoEncode() {
				clearTimeout(timeout);
				timeout = setTimeout(() => {
					if (latInput.value && lngInput.value) encode();
				}, 1000);
			}

			latInput.addEventListener('input', autoEncode);
			lngInput.addEventListener('input', autoEncode);

			// Auto-decode on GeoPin input
			let decodeTimeout;
			const geopinInput = document.getElementById('geopin');
			geopinInput.addEventListener('input', function () {
				this.value = this.value.toUpperCase();
				clearTimeout(decodeTimeout);
				decodeTimeout = setTimeout(() => {
					if (this.value.length >= 6) decode();
				}, 1500);
			});
		});
	</script>
</body>

</html>
